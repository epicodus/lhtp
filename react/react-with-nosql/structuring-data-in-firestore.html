<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-react/react-with-nosql/structuring-data-in-firestore" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Structuring Data in Firestore | LHTP</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://new.learnhowtoprogram.com/react/react-with-nosql/structuring-data-in-firestore"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Structuring Data in Firestore | LHTP"><meta data-rh="true" name="description" content="Just because NoSQL is flexible about structuring data doesn&#x27;t mean we should just throw documents in a NoSQL database as if it were a junk drawer. We can actually use Firestore to structure data in many different ways. Even though we don&#x27;t need a schema or database tables, we can still carefully plan how our data will be structured. In a real-world application, this is absolutely essential. SQL&#x27;s more rigid rules force us to plan ahead of time while NoSQL removes the guardrails — which will leave us open to headaches down the road if we don&#x27;t have a good plan."><meta data-rh="true" property="og:description" content="Just because NoSQL is flexible about structuring data doesn&#x27;t mean we should just throw documents in a NoSQL database as if it were a junk drawer. We can actually use Firestore to structure data in many different ways. Even though we don&#x27;t need a schema or database tables, we can still carefully plan how our data will be structured. In a real-world application, this is absolutely essential. SQL&#x27;s more rigid rules force us to plan ahead of time while NoSQL removes the guardrails — which will leave us open to headaches down the road if we don&#x27;t have a good plan."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://new.learnhowtoprogram.com/react/react-with-nosql/structuring-data-in-firestore"><link data-rh="true" rel="alternate" href="https://new.learnhowtoprogram.com/react/react-with-nosql/structuring-data-in-firestore" hreflang="en"><link data-rh="true" rel="alternate" href="https://new.learnhowtoprogram.com/react/react-with-nosql/structuring-data-in-firestore" hreflang="x-default"><script src="/usersnap-loader.js" defer="defer"></script><link rel="stylesheet" href="/assets/css/styles.c01e3e32.css">
<link rel="preload" href="/assets/js/runtime~main.cfb9200d.js" as="script">
<link rel="preload" href="/assets/js/main.57ee0fdd.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/lhtp-favicon.png" alt="Learn How to Program" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/lhtp-favicon.png" alt="Learn How to Program" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Learn How to Program</b></a><a class="navbar__item navbar__link" href="/courses">Courses</a><a class="navbar__item navbar__link" href="/student-handbook">Handbook</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/react">React</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/react/functional-programming-with-javascript/functional-programming-with-javascript-objectives">Functional Programming with JavaScript</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/react/react-fundamentals/react-fundamentals-objectives">React Fundamentals</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/react/react-with-redux/react-with-redux-objectives">React with Redux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/react/react-with-nosql/react-with-nosql-objectives">React with NoSQL</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/react/react-with-nosql/react-with-nosql-objectives">WEEKEND</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/react/react-with-nosql/react-with-nosql-objectives">React with NoSQL Objectives</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/react/react-with-nosql/introduction-to-hooks-with-the-usestate-hook">Introduction to Hooks with the useState Hook</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/react/react-with-nosql/running-side-effects-with-the-useeffect-hook">Running Side Effects with the useEffect Hook</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/react/react-with-nosql/the-rules-of-hooks-custom-hooks-and-why-hooks-are-awesome">The Rules of Hooks, Custom Hooks, and Why Hooks Are Awesome</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/react/react-with-nosql/refactoring-help-queue-to-use-hooks">Refactoring Help Queue to Use Hooks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/react/react-with-nosql/introduction-to-baas-firebase-and-firestore">Introduction to BaaS, Firebase, and Firestore</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/react/react-with-nosql/introduction-to-nosql">Introduction to NoSQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/react/react-with-nosql/the-cap-theorem-and-base">The CAP Theorem and BASE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/react/react-with-nosql/setting-up-a-firebase-project-firestore-database-and-web-app">Setting up a Firebase Project, Firestore Database, and Web App</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/react/react-with-nosql/firebase-documentation">Firebase Documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/react/react-with-nosql/adding-firebase-to-react">Adding Firebase to React</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/react/react-with-nosql/adding-tickets-to-firestore">Adding Tickets to Firestore</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/react/react-with-nosql/viewing-tickets-from-firestore">Viewing Tickets from Firestore</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/react/react-with-nosql/updating-and-deleting-tickets-in-firestore">Updating and Deleting Tickets in Firestore</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/react/react-with-nosql/structuring-data-in-firestore">Structuring Data in Firestore</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/react/react-with-nosql/journal-16">Journal #16</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/react/react-with-nosql/firestore-survey-quiz-of-choice-two-day-or-one-week-project">MONDAY</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/react/react-with-nosql/firestore-queries">TUESDAY</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/react/react-with-nosql/choose-your-own-adventure-two-day-or-one-week-project">WEDNESDAY</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/react/react-with-nosql/technical-interview-practice-nosql">THURSDAY</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/react/react-with-nosql/react-with-nosql-independent-project">FRIDAY</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/react/react-with-apis/apis-and-full-stack-development-objectives">React with APIs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/react/independent-capstone/independent-capstone-project-week-overview">Independent Capstone</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Alpn" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_xK9p"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">React with NoSQL</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">WEEKEND</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><a href="https://github.com/epicodus-curriculum/react-full-stack/blob/main/0o_structuring_data_in_firestore.md" target="_blank" rel="noopener noreferrer" class="breadcrumbs__link" itemprop="item"><span itemprop="name">Structuring Data in Firestore</span></a><meta itemprop="position" content="3"></li></ul></nav><div class="theme-doc-markdown markdown"><header><h1>Structuring Data in Firestore</h1></header><p>Just because NoSQL is flexible about structuring data doesn&#x27;t mean we should just throw documents in a NoSQL database as if it were a junk drawer. We can actually use Firestore to structure data in many different ways. Even though we don&#x27;t need a schema or database tables, we can still carefully plan how our data will be structured. In a real-world application, this is absolutely essential. SQL&#x27;s more rigid rules force us to plan ahead of time while NoSQL removes the guardrails — which will leave us open to headaches down the road if we don&#x27;t have a good plan.</p><p>For your multi-day projects in this course section, you may need to create more complex data structures for your application to function correctly. In this lesson, we will discuss three different ways to structure Firestore data. These ways are outlined in the <a href="https://firebase.google.com/docs/firestore/manage-data/structure-data" target="_blank" rel="noopener noreferrer">Firebase documentation</a> as well.</p><p>Let&#x27;s imagine we are building an application with information on hiking trails in the Pacific Northwest. We want to have the following data on each trail:</p><ul><li><code>name</code></li><li><code>description</code></li><li><code>region</code></li><li><code>reviews</code></li></ul><p>In a SQL database, we&#x27;d probably have a table called <code>Trails</code> and another table called <code>Reviews</code>. A trail could have many reviews while a review would belong to a single trail. Since our application would likely have users as well, a review would probably also belong to a user — but for our use case, we won&#x27;t worry about that. Potentially, we could have another table called <code>Regions</code> — a region could have many trails and a trail could belong to a single region.</p><p>However, we need to think about our data differently with NoSQL in general, and Firestore in particular. The considerations we&#x27;ll discuss here are specific to Firestore, but knowing the advantages and limitations of each approach with Firestore can also be helpful for planning other NoSQL database structures in the future.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nesting-data-in-a-single-document">Nesting Data in a Single Document<a href="#nesting-data-in-a-single-document" class="hash-link" aria-label="Direct link to Nesting Data in a Single Document" title="Direct link to Nesting Data in a Single Document">​</a></h2><hr><p>Documents in Firestore are sets of key-value pairs. They look like JSON objects — though it would be more accurate to use the more general term <strong>map</strong> to describe them. A map is a set of key-value pairs. For that reason, we can theoretically store all of the data for a trail in a single document. Here&#x27;s an example of how that data structure might look:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name: &quot;Enchantments Trail&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      region: &quot;Enchantments&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      description: &quot;23.6 mile trail through Enchantments near Leavenworth, WA.&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      reviews: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        1: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          content: &quot;Amazing!&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        2: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          content: &quot;Very challenging hike.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the example above, <code>reviews</code> is nested inside this document. We could, if we wanted, nest even more deeply.</p><p>The problem here, at least for the application we are talking about building, is obvious: these documents are going to get huge if there are a lot of reviews. This leads to several issues. There is an upper limit on the size of a Firestore document (1 megabyte or 20,000 fields). That&#x27;s actually a fair amount of data — but our documents would run out of space pretty quickly in a large application.</p><p>There&#x27;s another big disadvantage. We can&#x27;t just query part of a document. If we query a document, we return the whole thing — warts and all. We might just want to return the ten most popular reviews but we won&#x27;t be able to do that.</p><p>On the other hand, there are some use cases where the data structure above could work. If we know the data won&#x27;t expand too much (as it will with <code>reviews</code>) and we also know that we always want to return <em>all</em> the data stored in a document — the structure above could be beneficial because we wouldn&#x27;t have to make multiple queries to get all the data associated with a trail.</p><p>Enterprise applications will rarely go this route, but you may have a smaller application or a portfolio idea that could benefit from nesting data in a single document. Think carefully before you take this approach, though!</p><p><strong>Advantages:</strong> Easy to get data related to a document because it&#x27;s all stored in the same place.</p><p><strong>Disadvantages:</strong> Doesn&#x27;t scale well — and not recommended when data associated with a document will expand over time. This also isn&#x27;t performant because there is a limit to the number of read and writes that can be made to a single document at a time.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="adding-subcollections-to-documents">Adding Subcollections to Documents<a href="#adding-subcollections-to-documents" class="hash-link" aria-label="Direct link to Adding Subcollections to Documents" title="Direct link to Adding Subcollections to Documents">​</a></h2><hr><p>Students familiar with SQL databases might be tempted to try to recreate one-to-many relationships in Firestore. In some ways, adding a subcollection most closely mirrors creating a one-to-many relationship. However, it&#x27;s not really the same.</p><p>A document can have its own subcollections. In fact, we can easily add a subcollection to our Help Queue project via the Firestore database UI:</p><p><img loading="lazy" src="https://learnhowtoprogram.s3.us-west-2.amazonaws.com/React/Week-4-React-2020/Adding-firestore-subcollection.png" alt="Example shows how we can add a subcollection to a record in Firestore&#x27;s UI." class="img_ev3q"></p><p>In the example above, we could click on a ticket from our Help Queue database, then click on &quot;Start collection&quot; (circled in red in the image above) in the rightmost panel to add a collection to that document. This wouldn&#x27;t just be a collection, it would be a subcollection within the <code>tickets</code> collection.</p><p>If we used a subcollection in our Firestore database for our application about hiking trails in the Pacific NorthWest, it would make the most sense to make trails reviews a subcollection of a trail document. This structure would look something like this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name: &quot;Enchantments Trail&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      region: &quot;Enchantments&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      description: &quot;23.6 mile trail through Enchantments near Leavenworth, WA.&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Reviews Subcollection (belongs to &quot;Enchantments Trail&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  content: &quot;Amazing!&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  content: &quot;Very challenging hike.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Firestore lists this as a feasible approach but we don&#x27;t recommend it. Firestore can only query a single collection at a time, so to get a subcollection, we&#x27;d need to make two queries: one for the trail, and then another one for the reviews. So, if we wanted to find all the trail reviews by a specific user, for example, we definitely wouldn&#x27;t be able to do that with a single query.</p><p>This is because Firestore queries are always shallow. They only return the top level of data, not subcollections. We can take advantage of this, however, if we design our application to only display the trails data without the reviews. In another page we could show the reviews, but only if the user navigates there. Separating this out could indeed make our application more performant since each database query would take less time. </p><p>In our case, this probably wouldn&#x27;t be much of an advantage, though — and the pain of trying to query across multiple collections would be a huge disadvantage.</p><p>Another issue with this approach is writing the code for creating subcollections. The documentation on this is not extensive. However, let&#x27;s say we wanted to have a subcollection of reviews for a specific trail. To add a review to the Enchantments Trail, we&#x27;d have to do something like this:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">addDoc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">collection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;trails&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;q2WkYeRXEZWoG0EnTzkh&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;reviews&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newReviewData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that <code>&quot;q2WkYeRXEZWoG0EnTzkh&quot;</code> is the id of the trail document, and <code>&quot;reviews&quot;</code> is the subcollection within <code>&quot;trails&quot;</code>. Also, with the above code, we&#x27;re not specifying an ID for the new review document, but letting Firestore auto-generate one. </p><p>We could do this instead, if we wanted to provide an ID for the new review document:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">setDoc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">doc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;trails&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;q2WkYeRXEZWoG0EnTzkh&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;reviews&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newReviewData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the both of the examples above, we have to specify a collection, then the doc within the collection (which may or may not exist yet), then specify another collection within that doc.</p><p>Things can get messy quickly, the subcollections can get difficult to query, and if the parent doc gets deleted, that can leave the subcollection orphaned, making it very difficult to access. That&#x27;s because deleting a document does not also automatically delete any subcollections that are associated with it.</p><p>While this approach most closely maps to creating a one-to-many relationship, we don&#x27;t really recommend it even though it&#x27;s listed as a valid option in the Firestore documentation. It certainly is valid — and there are use cases — but be prepared for headaches with this approach.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-multiple-collections-for-data">Using Multiple Collections for Data<a href="#using-multiple-collections-for-data" class="hash-link" aria-label="Direct link to Using Multiple Collections for Data" title="Direct link to Using Multiple Collections for Data">​</a></h2><hr><p>The final recommendation, and the one that&#x27;s probably effective for the most use cases, is to just use multiple collections. In this situation, we&#x27;d have separate collections for trails and reviews. In order to create something similar to a one-to-many association, we&#x27;d need to manually create the association between a trail and a review in our code. Rails and .NET coders can apply their SQL knowledge here. We just need to add a field like <code>trailId</code> to a review. The code for creating an association might look something like this:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">addDoc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">collection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;reviews&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">trailId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> tid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">content</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Amazing trail!&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here, we add a review that has a trail&#x27;s id associated with it. At that point, if we wanted to find all reviews associated with a trail, we could make a query to find reviews that have a <code>trailId</code> equal to the trail&#x27;s id.</p><p>In this way, we can still make associations that are somewhat similar to what we might do with a SQL database. Firestore&#x27;s queries are extremely fast because all records and fields are indexed. A database index is like an index in the back of a book that allows you to quickly find a record without having to search every row in the database. This means it will take about the same amount of time to run a query to grab reviews associated with a specific trail id as it would to just grab the whole collection of reviews. </p><p>Remember that NoSQL databases scale well horizontally, so it&#x27;s fine to have multiple large, shallow collections instead of deeply nested data.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2><hr><p>In this lesson, we&#x27;ve covered three approaches for creating a data structure in a Firestore application. All three have their use cases, but the third generally works best with Firestore&#x27;s current capacities. As we can see, we can still make associations between different pieces of data in our code. It&#x27;s just that NoSQL doesn&#x27;t have a structure to enforce or check these relationships. We are entirely on the hook for creating them on our own.</p><p>As always, your use case will determine which kind of data structure works best for your application. In the example above, creating several collections and manually creating associations in the code between documents is probably the best approach.</p><p>However, if we were making a game where a user could hold a limited number of items, the first or second approach would probably be better. Having an <code>items</code> property on a <code>character</code> that has a maximum of nine slots would be reasonable — and we&#x27;d probably want to return all nine items each time we were pulling up the character anyway.</p><p>Creating subcollections for a document might be a solid option if you&#x27;ll have a relatively limited number of items in that subcollection — but you don&#x27;t want those results to be returned every single time. If we had an application about books, for example, each book document might have general information such as <code>description</code> and <code>name</code> — but we wouldn&#x27;t want to include the whole text in the record because it would take a long time to query each book. Instead, we might create a subcollection called <code>chapters</code> that has the text for each chapter. The query for the general description of the book would still be very fast — but if needed, we could do an additional, slower query to get all the text in the subcollection. As long as we didn&#x27;t want to do a query across all the chapters of all the different books in our application, this would work fine.</p><p>If you&#x27;d like more information, see Firestore&#x27;s <a href="https://firebase.google.com/docs/firestore/manage-data/structure-data" target="_blank" rel="noopener noreferrer">documentation on data structures</a>. The videos included in the documentation are also recommended.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/react/react-with-nosql/updating-and-deleting-tickets-in-firestore"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Updating and Deleting Tickets in Firestore</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/react/react-with-nosql/journal-16"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Journal #16</div></a></nav></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Epicodus, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.cfb9200d.js"></script>
<script src="/assets/js/main.57ee0fdd.js"></script>
</body>
</html>